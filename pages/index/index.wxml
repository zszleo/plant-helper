<!--pages/index/index.wxml-->
<wxs module="statusFormatter">
var formatStatus = function(status) {
  var statusMap = {
    'healthy': 'å¥åº·',
    'growing': 'ç”Ÿé•¿ä¸­',
    'need-care': 'éœ€ç…§æ–™',
    'diseased': 'ç”Ÿç—…'
  }
  return statusMap[status] || 'æœªçŸ¥'
}
module.exports = {
  formatStatus: formatStatus
}
</wxs>
<!-- é¡¶éƒ¨æœç´¢æ  -->
<view class="search-bar">
  <view class="search-input-wrapper">
    <image class="search-icon" src="/images/search.svg" mode="aspectFit"></image>
    <input
      class="search-input"
      placeholder="æœç´¢æ¤ç‰©åç§°æˆ–ç±»å‹"
      value="{{searchKeyword}}"
      bindinput="onSearchInput"
      bindconfirm="onSearch"
    />
    <view class="clear-btn" wx:if="{{searchKeyword}}" bindtap="onClearSearch">
      <image class="clear-icon" src="/images/close.svg" mode="aspectFit"></image>
    </view>
  </view>
  <view class="sync-btn" bindtap="onSync">
    <image class="sync-icon" src="/images/sync.svg" mode="aspectFit"></image>
    <text class="sync-text">åŒæ­¥</text>
  </view>
</view>

<scroll-view class="container {{pageAnimationClass}}" id="pageContainer" scroll-y="{{true}}" show-scrollbar="{{true}}" bindtouchstart="onTouchStart" bindtouchend="onTouchEnd" bindscrolltolower="onReachBottom">
  <!-- æ¤ç‰©åˆ—è¡¨ -->
  <view class="plant-list">
    <view class="plant-card" wx:for="{{filteredPlants}}" wx:key="_id" bindtap="onPlantDetail" data-id="{{item._id}}">
      <image class="plant-image" src="{{item.imageUrl || '/images/plant-placeholder.svg'}}" mode="aspectFill"></image>
      <view class="plant-info">
        <text class="plant-name">{{item.name}}</text>
        <view class="plant-meta">
          <text class="plant-type">{{item.type}}</text>
          <text class="meta-separator">Â·</text>
          <view class="plant-status">
            <text class="status-text">{{statusFormatter.formatStatus(item.status)}}</text>
            <text class="status-icon">{{item.status === 'healthy' ? 'ğŸŒ¿' : item.status === 'growing' ? 'ğŸŒ±' : item.status === 'need-care' ? 'âš ï¸' : item.status === 'diseased' ? 'ğŸš¨' : ''}}</text>
          </view>
        </view>
        <text class="plant-description" wx:if="{{item.description}}">{{item.description}}</text>
      </view>
      <view class="plant-actions">
        <text class="record-count">{{item.recordCount || 0}}æ¡è®°å½•</text>
        <image class="arrow-icon" src="/images/arrow-right.svg" mode="aspectFit"></image>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤šæç¤º -->
    <view class="load-more" wx:if="{{filteredPlants.length > 0}}">
      <text class="load-more-text" wx:if="{{isLoading}}">åŠ è½½ä¸­...</text>
      <text class="load-more-text" wx:elif="{{!hasMore}}">æ²¡æœ‰æ›´å¤šäº†</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{filteredPlants.length === 0}}">
      <image class="empty-icon" src="/images/empty-plants.svg" mode="aspectFit"></image>
      <text class="empty-text">è¿˜æ²¡æœ‰æ·»åŠ æ¤ç‰©</text>
      <text class="empty-hint">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ·»åŠ ä½ çš„ç¬¬ä¸€æ ªæ¤ç‰©</text>
    </view>
  </view>

  <!-- æ·»åŠ æŒ‰é’® -->
  <view class="add-btn" bindtap="onAddPlant">
    <image class="add-icon" src="/images/add.svg" mode="aspectFit"></image>
  </view>
</scroll-view>
