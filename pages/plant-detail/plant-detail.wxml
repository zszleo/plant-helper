<!--pages/plant-detail/plant-detail.wxml-->
<wxs module="statusFormatter">
var formatStatus = function(status) {
  var statusMap = {
    'healthy': 'å¥åº·',
    'growing': 'ç”Ÿé•¿ä¸­',
    'need-care': 'éœ€ç…§æ–™',
    'diseased': 'ç”Ÿç—…'
  }
  return statusMap[status] || 'æœªçŸ¥'
}
module.exports = {
  formatStatus: formatStatus
}
</wxs>
<view class="container" wx:if="{{plant}}">
  <!-- æ¤ç‰©å›¾ç‰‡å¡ç‰‡ -->
  <view class="image-card-wrapper">
    <view class="image-card-middle">
      <view class="image-card-inner">
        <image
          class="plant-image"
          src="{{plant.imageUrl || '/images/plant-placeholder.svg'}}"
          mode="aspectFill"
        ></image>
      </view>
    </view>
  </view>

  <!-- æ¤ç‰©ä¿¡æ¯å¡ç‰‡ -->
  <view class="info-card">
    <view class="info-header">
      <text class="plant-name">{{plant.name}}</text>
      <view class="plant-status">
        <text class="status-text">{{statusFormatter.formatStatus(plant.status)}}</text>
        <text class="status-icon">{{plant.status === 'healthy' ? 'ğŸŒ¿' : plant.status === 'growing' ? 'ğŸŒ±' : plant.status === 'need-care' ? 'âš ï¸' : plant.status === 'diseased' ? 'ğŸš¨' : ''}}</text>
      </view>
    </view>

    <view class="info-grid">
      <view class="info-item">
        <text class="info-label">ç±»å‹</text>
        <text class="info-value">{{plant.type}}</text>
      </view>
      <view class="info-item">
        <text class="info-label">ç§æ¤æ—¥æœŸ</text>
        <text class="info-value">{{plant.plantDateFormatted}}</text>
      </view>
      <view class="info-item">
        <text class="info-label">è®°å½•æ•°</text>
        <text class="info-value">{{recordCount}}æ¡</text>
      </view>
      <view class="info-item">
        <text class="info-label">ç§æ¤å¤©æ•°</text>
        <text class="info-value">{{plantDays}}å¤©</text>
      </view>
    </view>

    <view class="info-description" wx:if="{{plant.description}}">
      <text class="description-label">å¤‡æ³¨</text>
      <text class="description-text">{{plant.description}}</text>
    </view>
  </view>


  <!-- ç”Ÿé•¿è®°å½•å¡ç‰‡ -->
  <view class="records-card">
    <view class="section-header">
      <text class="section-title">ç”Ÿé•¿è®°å½•</text>
      <view class="section-more" bindtap="onViewAllRecords">
        <text class="more-text">æŸ¥çœ‹å…¨éƒ¨</text>
        <image class="more-icon" src="/images/arrow-right.svg" mode="aspectFit"></image>
      </view>
    </view>

    <view class="records-list">
      <view class="record-card" wx:for="{{recentRecordsWithIcons}}" wx:key="_id" bindtap="onRecordDetail" data-id="{{item._id}}">
        <view class="card-header">
          <view class="card-icon-wrapper">
            <image class="card-icon" src="{{item.recordIcon}}" mode="aspectFit"></image>
          </view>
          <view class="card-title-wrapper">
            <text class="card-title">{{item.recordTitle}}</text>
            <text class="card-time">{{item.formattedTime}}</text>
          </view>
          <image class="card-arrow" src="/images/arrow-right.svg" mode="aspectFit"></image>
        </view>
        <view class="card-note" wx:if="{{item.notes}}">
          <text class="note-text">{{item.notes}}</text>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-records" wx:if="{{recentRecordsWithIcons.length === 0}}">
        <image class="empty-icon" src="/images/empty-records.svg" mode="aspectFit"></image>
        <text class="empty-text">è¿˜æ²¡æœ‰è®°å½•</text>
        <text class="empty-hint">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ ç¬¬ä¸€æ¡è®°å½•</text>
      </view>
    </view>
  </view>

  <!-- æ·»åŠ è®°å½•æµ®åŠ¨æŒ‰é’® -->
  <view class="add-btn" bindtap="onFloatAddRecord">
    <image class="add-icon" src="/images/add.svg" mode="aspectFit"></image>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions">
    <view class="action-btn edit-btn" bindtap="onEdit">
      <image class="btn-icon" src="/images/edit.svg" mode="aspectFit"></image>
      <text class="btn-text">ç¼–è¾‘</text>
    </view>
    <view class="action-btn delete-btn" bindtap="onDelete">
       <image class="btn-icon" src="/images/delete.svg" mode="aspectFit"></image>
      <text class="btn-text">åˆ é™¤</text>
    </view>
  </view>
</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading-container" wx:if="{{!plant}}">
  <view class="loading-spinner"></view>
  <text class="loading-text">åŠ è½½ä¸­...</text>
</view>
