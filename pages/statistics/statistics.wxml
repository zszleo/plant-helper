<!--pages/statistics/statistics.wxml-->
<view class="container">
  <!-- 植物状态统计 -->
  <view class="section">
    <view class="section-title">植物状态统计</view>
    <view class="plant-status-summary">
      <view class="summary-item" bindtap="onTotalPlantsClick">
        <view class="summary-value">{{plantStatus.total}}</view>
        <view class="summary-label">总植物数</view>
      </view>
    </view>
    <view class="plant-status-detail">
      <view class="status-card" wx:for="{{[plantStatus.healthy, plantStatus.growing, plantStatus['need-care'], plantStatus.diseased]}}" wx:key="label">
        <view class="status-card-header">
          <view class="status-icon" style="background-color: {{item.color}}20; color: {{item.color}}">{{item.icon}}</view>
          <view class="status-info">
            <view class="status-name">{{item.label}}</view>
          </view>
          <view class="status-stats">
            <view class="status-percent" style="color: {{item.color}}">{{item.percent}}%</view>
            <view class="status-count-text">{{item.count}}株</view>
          </view>
        </view>
        <view class="status-progress">
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{item.percent}}%; background-color: {{item.color}}"></view>
          </view>
          <view class="progress-text">{{item.percent}}%</view>
        </view>
      </view>
    </view>
  </view>

  <!-- 记录类型分布 -->
  <view class="section">
    <view class="section-title">记录类型分布</view>
    <view class="type-distribution">
      <view class="type-item" wx:for="{{recordStats}}" wx:key="type">
        <view class="type-icon {{item.type}}" style="background-color: {{item.color}}20; color: {{item.color}}">{{item.icon}}</view>
        <view class="type-info">
          <view class="type-name">{{item.name}}</view>
        </view>
        <view class="type-stats">
          <view class="type-percent" style="color: {{item.color}}">{{item.percent}}%</view>
          <view class="type-count-text">{{item.count}}次</view>
        </view>
      </view>
    </view>
  </view>

  <!-- 每月趋势 - GitHub风格热力图 -->
  <view class="section">
    <view class="section-header">
      <view class="section-title">每月趋势</view>
      <view class="heatmap-legend">
        <view class="legend-item">少</view>
        <view class="legend-box level-0"></view>
        <view class="legend-box level-1"></view>
        <view class="legend-box level-2"></view>
        <view class="legend-box level-3"></view>
        <view class="legend-box level-4"></view>
        <view class="legend-item">多</view>
      </view>
    </view>
    <view class="calendar-heatmap">
      <view class="weekday-labels">
        <view class="weekday-label">一</view>
        <view class="weekday-label">二</view>
        <view class="weekday-label">三</view>
        <view class="weekday-label">四</view>
        <view class="weekday-label">五</view>
        <view class="weekday-label">六</view>
        <view class="weekday-label">日</view>
      </view>
      <view class="calendar-grid">
        <view class="calendar-row" wx:for="{{calendarData}}" wx:key="weekIndex">
          <view
            class="calendar-cell {{cell.level >= 0 ? 'level-' + cell.level : ''}} {{activeCell === cell.date ? 'active' : ''}}"
            wx:for="{{item.cells}}"
            wx:for-item="cell"
            wx:key="date"
            bindtap="onCellTap"
            data-date="{{cell.date}}"
            data-count="{{cell.count}}"
          >
            <view class="cell-date">{{cell.day}}</view>
            <view class="cell-tooltip" wx:if="{{activeCell === cell.date && cell.count > 0}}">{{cell.date}} {{cell.count}}次记录</view>
          </view>
        </view>
      </view>
    </view>
    <view class="heatmap-summary">
      <view class="summary-text">本月共记录 <text class="summary-count">{{totalRecords}}</text> 次</view>
    </view>
  </view>
</view>
